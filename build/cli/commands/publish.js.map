{"version":3,"sources":["../../../src/cli/commands/publish.js"],"names":["command","describe","builder","r","alias","demandOption","type","handler","argv","console","log","chalk","bold","white","pkg","version","spinner","text","start","publish","PublishTask","on","subtaskNumber","subtaskCount","subtaskName","gray","run","registry","then","packageInfo","succeed","green","gitpkgRegistry","gitpkgPackage","name","catch","err","stopAndPersist","fail","red","message","process","exit"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEO,MAAMA,4BAAU,SAAhB;;AAEA,MAAMC,8BAAW,oDAAjB;;AAEA,MAAMC,4BAAU;AACrBC,KAAG;AACDC,WAAO,UADN;AAEDC,kBAAc,KAFb;AAGDJ,cAAU,qEAHT;AAIDK,UAAM;AAJL;AADkB,CAAhB;;AASA,MAAMC,4BAAUC,QAAQ;AAC7B;AACAC,UAAQC,GAAR,CAAYC,gBAAMC,IAAN,CAAWC,KAAX,CAAkB,mBAAkBC,kBAAIC,OAAQ,EAAhD,CAAZ;AACA,QAAMC,UAAU,mBAAI,EAAEC,MAAM,eAAR,EAAJ,EAA+BC,KAA/B,EAAhB;;AAEA,QAAMC,UAAU,IAAIC,iBAAJ,EAAhB;AACAD,UAAQE,EAAR,CAAW,SAAX,EAAsB,CAACC,aAAD,EAAgBC,YAAhB,EAA8BC,WAA9B,KAA8C;AAClER,YAAQC,IAAR,GAAgB,GAAEN,gBAAMc,IAAN,CAAY,IAAGH,aAAc,IAAGC,YAAa,GAA7C,CAAiD,IAAGC,WAAY,KAAlF;AACD,GAFD;;AAIA,SAAOL,QACJO,GADI,CACA,EAAEC,UAAUnB,KAAKmB,QAAjB,EADA,EAEJC,IAFI,CAECC,eAAe;AACnBb,YAAQc,OAAR,CACG,GAAEnB,gBAAMC,IAAN,CAAWmB,KAAX,CACD,SADC,CAED,wBAAuBF,YAAYG,cAAe,kBAAiBH,YAAYI,aAAc,GAHjG;AAKAxB,YAAQC,GAAR,CAAa,KAAImB,YAAYK,IAAK,IAAGL,YAAYd,OAAQ,EAAzD;AACD,GATI,EAUJoB,KAVI,CAUEC,OAAO;AACZpB,YAAQqB,cAAR;AACArB,YAAQsB,IAAR,CAAc,GAAE3B,gBAAMC,IAAN,CAAW2B,GAAX,CAAe,OAAf,CAAwB,IAAGH,IAAII,OAAQ,EAAvD;AACAC,YAAQC,IAAR,CAAa,CAAb;AACD,GAdI,CAAP;AAeD,CAzBM","file":"publish.js","sourcesContent":["import ora from 'ora';\nimport chalk from 'chalk';\nimport pkg from '../../../package.json';\nimport PublishTask from '../../tasks/Publish';\n\nexport const command = 'publish';\n\nexport const describe = 'Publishes a package to a git repository as git tag';\n\nexport const builder = {\n  r: {\n    alias: 'registry',\n    demandOption: false,\n    describe: 'Specify the gitpkg registry (defaults to the git remote origin url)',\n    type: 'string'\n  }\n};\n\nexport const handler = argv => {\n  /* eslint-disable no-console */\n  console.log(chalk.bold.white(`gitpkg publish v${pkg.version}`));\n  const spinner = ora({ text: 'Processing...' }).start();\n\n  const publish = new PublishTask();\n  publish.on('subtask', (subtaskNumber, subtaskCount, subtaskName) => {\n    spinner.text = `${chalk.gray(`[${subtaskNumber}/${subtaskCount}]`)} ${subtaskName}...`;\n  });\n\n  return publish\n    .run({ registry: argv.registry })\n    .then(packageInfo => {\n      spinner.succeed(\n        `${chalk.bold.green(\n          'success'\n        )} Package uploaded to ${packageInfo.gitpkgRegistry} with the name ${packageInfo.gitpkgPackage}.`\n      );\n      console.log(`+ ${packageInfo.name}@${packageInfo.version}`);\n    })\n    .catch(err => {\n      spinner.stopAndPersist();\n      spinner.fail(`${chalk.bold.red('error')} ${err.message}`);\n      process.exit(1);\n    });\n};\n"]}