{"version":3,"sources":["../../../src/tasks/Task/read-package-manifest.js"],"names":["readFile","util","promisify","fs","readPackageManifest","pkgPath","packagePath","path","resolve","pkg","JSON","parse","scripts","validatePackageJSON","e","name","Error","version","semver","valid"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,WAAWC,eAAKC,SAAL,CAAeC,aAAGH,QAAlB,CAAjB;;kBAEe,eAAeI,mBAAf,CAAmCC,OAAnC,EAA4C;AACzD,QAAMC,cAAcC,eAAKC,OAAL,CAAaH,OAAb,EAAsB,cAAtB,CAApB;AACA,MAAI;AACF,UAAMI,MAAMC,KAAKC,KAAL,EAAW,MAAMX,SAASM,WAAT,EAAsB,OAAtB,CAAjB,EAAZ;AACAG,QAAIG,OAAJ,GAAcH,IAAIG,OAAJ,IAAe,EAA7B;AACAC,wBAAoBJ,GAApB;AACA,WAAOA,GAAP;AACD,GALD,CAKE,OAAOK,CAAP,EAAU;AACV,UAAMA,CAAN;AACD;AACF,C;;AAED,SAASD,mBAAT,CAA6BJ,GAA7B,EAAkC;AAChC,MAAI,CAACA,IAAIM,IAAT,EAAe;AACb,UAAM,IAAIC,KAAJ,CAAU,8BAAV,CAAN;AACD;;AAED,MAAI,CAACP,IAAIQ,OAAT,EAAkB;AAChB,UAAM,IAAID,KAAJ,CAAU,iCAAV,CAAN;AACD;;AAED,MAAI,CAACE,iBAAOC,KAAP,CAAaV,IAAIQ,OAAjB,CAAL,EAAgC;AAC9B,UAAM,IAAID,KAAJ,CAAU,yBAAV,CAAN;AACD;AACF","file":"read-package-manifest.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\nimport util from 'util';\n\nconst readFile = util.promisify(fs.readFile);\n\nexport default async function readPackageManifest(pkgPath) {\n  const packagePath = path.resolve(pkgPath, 'package.json');\n  try {\n    const pkg = JSON.parse(await readFile(packagePath, 'utf-8'));\n    pkg.scripts = pkg.scripts || {};\n    validatePackageJSON(pkg);\n    return pkg;\n  } catch (e) {\n    throw e;\n  }\n}\n\nfunction validatePackageJSON(pkg) {\n  if (!pkg.name) {\n    throw new Error(\"Package doesn't have a name.\");\n  }\n\n  if (!pkg.version) {\n    throw new Error(\"Package doesn't have a version.\");\n  }\n\n  if (!semver.valid(pkg.version)) {\n    throw new Error('Invalid semver version.');\n  }\n}\n"]}